<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Dashboard | Premium</title>
    <style>
        :root {
            --bg: #050505; --sidebar-bg: #0a0a0a; --card-bg: #121212;
            --accent: #ffffff; --text-main: #ffffff; --text-dim: #a1a1a1;
            --border: #262626; --danger: #ff4444;
        }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; }
        aside { width: 260px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 30px 20px; }
        .logo { font-size: 1.5rem; font-weight: 800; margin-bottom: 50px; letter-spacing: -1px; }
        nav { display: flex; flex-direction: column; gap: 10px; }
        nav button { background: transparent; border: none; color: var(--text-dim); text-align: left; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        nav button.active, nav button:hover { background: var(--card-bg); color: var(--text-main); }
        main { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }
        header { padding: 20px 40px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: var(--bg); z-index: 10; }
        .search-bar { background: var(--card-bg); border: 1px solid var(--border); padding: 10px 20px; border-radius: 10px; color: white; width: 400px; }
        .btn-main { background: var(--accent); color: black; border: none; padding: 12px 24px; border-radius: 10px; font-weight: 700; cursor: pointer; }
        .content-area { padding: 40px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        .event-card { background: var(--card-bg); border: 1px solid var(--border); padding: 25px; border-radius: 20px; transition: 0.3s; }
        .event-card:hover { border-color: #555; }
        .event-id { font-size: 0.85rem; color: var(--text-dim); font-weight: 400; margin-left: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: left; color: var(--text-dim); padding: 15px; border-bottom: 1px solid var(--border); }
        td { padding: 15px; border-bottom: 1px solid var(--border); }
        .btn-view { background: #222; color: white; border: 1px solid var(--border); padding: 8px 15px; border-radius: 8px; cursor: pointer; }
        .btn-del { background: transparent; border: 1px solid #331111; color: var(--danger); padding: 8px 15px; border-radius: 8px; cursor: pointer; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: var(--card-bg); padding: 40px; border-radius: 24px; width: 400px; border: 1px solid var(--border); }
        .modal-content input { width: 100%; padding: 12px; margin: 10px 0; background: #1a1a1a; border: 1px solid var(--border); color: white; border-radius: 8px; box-sizing: border-box; }
        /* –¢–æ—Ç —Å–∞–º—ã–π –æ—Ç—Å—Ç—É–ø –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π */
        .modal-content input:last-of-type { margin-bottom: 30px; }
    </style>
</head>
<body>
<aside>
    <div class="logo">EVENT.PRO</div>
    <nav>
        <button id="navEvents" class="active" onclick="showView('events')">Events Catalog</button>
        <button id="navParts" onclick="showView('parts')">All Participants</button>
    </nav>
</aside>
<main>
    <header>
        <input type="text" id="mainSearch" class="search-bar" placeholder="Search events..." oninput="handleSearch(this.value)">
        <button id="mainBtn" class="btn-main" onclick="openModal('addEventModal')">+ Add Event</button>
    </header>
    <div class="content-area">
        <div id="eventsView"><div class="grid" id="eventGrid"></div></div>
        <div id="participantsView" style="display: none;">
            <h2>Participants Directory</h2>
            <table>
                <thead><tr><th>Name</th><th>Email</th><th>Event ID</th><th style="text-align: right;">Actions</th></tr></thead>
                <tbody id="partTableBody"></tbody>
            </table>
        </div>
    </div>
</main>

<div id="addEventModal" class="modal"><div class="modal-content">
    <h2>Create Event</h2>
    <input type="text" id="evName" placeholder="Event Name">
    <input type="date" id="evDate">
    <input type="text" id="evLoc" placeholder="Location">
    <button class="btn-main" style="width:100%" onclick="saveEvent()">Save Event</button>
    <button class="btn-view" style="width:100%; margin-top:10px; border:none" onclick="closeModal('addEventModal')">Cancel</button>
</div></div>

<div id="addPartModal" class="modal"><div class="modal-content">
    <h2>Register Participant</h2>
    <input type="text" id="pName" placeholder="Full Name">
    <input type="email" id="pEmail" placeholder="Email Address">
    <input type="number" id="pEventId" placeholder="Event ID">
    <button class="btn-main" style="width:100%" onclick="saveParticipant()">Register Now</button>
    <button class="btn-view" style="width:100%; margin-top:10px; border:none" onclick="closeModal('addPartModal')">Cancel</button>
</div></div>

<script>
    const API = 'http://localhost:8080';
    let allEvents = []; let allParts = []; let currentView = 'events';

    async function loadData() {
        try {
            const [evR, pR] = await Promise.all([fetch(`${API}/events`), fetch(`${API}/participants`)]);
            allEvents = await evR.json(); allParts = await pR.json();
            renderAll();
        } catch(e) { console.error("API Offline"); }
    }

    function renderAll() {
        document.getElementById('eventGrid').innerHTML = allEvents.map(e => `
            <div class="event-card">
                <h3>${e.name} <span class="event-id">#${e.id}</span></h3>
                <p>üìÖ ${e.date}</p><p>üìç ${e.location}</p>
                <div style="margin-top:15px; display:flex; gap:10px">
                    <button class="btn-view" style="flex:1">View</button>
                    <button class="btn-del" onclick="deleteEvent(${e.id})">üóë</button>
                </div>
            </div>
        `).join('');

        document.getElementById('partTableBody').innerHTML = allParts.map(p => `
            <tr>
                <td>${p.name}</td><td>${p.email}</td>
                <td><span class="event-id" style="margin:0">#${p.eventId}</span></td>
                <td style="text-align: right;"><button class="btn-del" onclick="deleteParticipant(${p.id})">Delete</button></td>
            </tr>
        `).join('');
    }

    function showView(view) {
        currentView = view;
        const isEv = view === 'events';
        document.getElementById('eventsView').style.display = isEv ? 'block' : 'none';
        document.getElementById('participantsView').style.display = isEv ? 'none' : 'block';
        document.getElementById('mainBtn').innerText = isEv ? '+ Add Event' : '+ Add Participant';
        document.getElementById('mainBtn').onclick = () => openModal(isEv ? 'addEventModal' : 'addPartModal');
        document.getElementById('mainSearch').placeholder = isEv ? 'Search events...' : 'Search participants...';
        document.getElementById('navEvents').classList.toggle('active', isEv);
        document.getElementById('navParts').classList.toggle('active', !isEv);
    }

    function handleSearch(val) {
        const query = val.toLowerCase();
        if (currentView === 'events') {
            const filtered = allEvents.filter(e => e.name.toLowerCase().includes(query));
            document.getElementById('eventGrid').innerHTML = filtered.map(e => `<div class="event-card">...</div>`).join(''); // –£–ø—Ä–æ—Å—Ç–∏–ª –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
        }
    }

    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    async function saveEvent() {
        const data = { name: document.getElementById('evName').value, date: document.getElementById('evDate').value, location: document.getElementById('evLoc').value };
        await fetch(`${API}/events`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data)});
        closeModal('addEventModal'); loadData();
    }

    async function saveParticipant() {
        const data = { name: document.getElementById('pName').value, email: document.getElementById('pEmail').value, eventId: parseInt(document.getElementById('pEventId').value) };
        await fetch(`${API}/participants`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data)});
        closeModal('addPartModal'); loadData();
    }

    async function deleteEvent(id) { if(confirm('Delete Event?')) { await fetch(`${API}/events/${id}`, {method:'DELETE'}); loadData(); } }
    async function deleteParticipant(id) { if(confirm('Delete Participant?')) { await fetch(`${API}/participants/${id}`, {method:'DELETE'}); loadData(); } }

    loadData();
</script>
</body>
</html>